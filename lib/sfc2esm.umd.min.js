!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@vue/compiler-sfc"),require("@vue/shared"),require("vue"),require("@vue/compiler-sfc/dist/compiler-sfc.esm-browser"),require("crypto")):"function"==typeof define&&define.amd?define(["exports","@vue/compiler-sfc","@vue/shared","vue","@vue/compiler-sfc/dist/compiler-sfc.esm-browser","crypto"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sfc2esm={},e.sfcCompiler,e.shared,e.Vue,e.sfcCompilerEsm,e.Crypto)}(this,(function(e,t,r,n,s,o){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var a=i(s),c=i(o);const l="__sfc__";let p=a;async function f({filename:e,code:t,compiled:r}){if(!t.trim())return void($.errors=[]);if(!e.endsWith(".vue"))return r.js=r.ssr=t,void($.errors=[]);const n=await(e=>c.createHash("sha256").update(e).digest("base64").slice(0,16))(e),{errors:s,descriptor:o}=p.parse(t,{filename:e,sourceMap:!0});if(s.length)return void($.errors=s);if(o.script&&o.script.lang||o.scriptSetup&&o.scriptSetup.lang||o.styles.some((e=>e.lang))||o.template&&o.template.lang)return void($.errors=['lang="x" pre-processors are not supported in the in-browser playground.']);const i=o.styles.some((e=>e.scoped));let a="",l="";const f=e=>{a+=e,l+=e},m=d(o,n,!1);if(!m)return;const[_,y]=m;if(a+=_,o.scriptSetup){const e=d(o,n,!0);if(!e)return;l+=e[0]}else l+=_;if(o.template&&!o.scriptSetup){const e=u(o,n,y,!1);if(!e)return;a+=e;const t=u(o,n,y,!0);if(!t)return;l+=t}i&&f(`\n__sfc__.__scopeId = ${JSON.stringify(`data-v-${n}`)}`),(a||l)&&(f(`\n__sfc__.__file = ${JSON.stringify(e)}\nexport default __sfc__`),r.js=a.trimStart(),r.ssr=l.trimStart());let g="";for(const t of o.styles){if(t.module)return void($.errors=["<style module> is not supported in the playground."]);const r=await p.compileStyleAsync({source:t.content,filename:e,id:n,scoped:t.scoped,modules:!!t.module});r.errors.length?r.errors[0].message.includes("pathToFileURL")||($.errors=r.errors):g+=r.code+"\n"}r.css=g?g.trim():"/* No <style> tags present */",$.errors=[]}function d(e,t,r){if(!e.script&&!e.scriptSetup)return["\nconst __sfc__ = {}",void 0];try{const n=p.compileScript(e,{id:t,refSugar:!0,inlineTemplate:!0,templateOptions:{ssr:r,ssrCssVars:e.cssVars}});let s="";return n.bindings&&(s+=`\n/* Analyzed bindings: ${JSON.stringify(n.bindings,null,2)} */`),s+="\n"+p.rewriteDefault(n.content,l),[s,n.bindings]}catch(e){return void($.errors=[e])}}function u(e,t,r,n){const s=p.compileTemplate({source:e.template.content,filename:e.filename,id:t,scoped:e.styles.some((e=>e.scoped)),slotted:e.slotted,ssr:n,ssrCssVars:e.cssVars,isProd:!1,compilerOptions:{bindingMetadata:r}});if(s.errors.length)return void($.errors=s.errors);const o=n?"ssrRender":"render";return`\n${s.code.replace(/\nexport (function|const) (render|ssrRender)/,`$1 ${o}`)}\n__sfc__.${o} = ${o}`}const m="App.vue",_="main.js",y=e=>`import { createApp as _createApp } from "vue"\n\nif (window.__app__) {\n  window.__app__.unmount()\n  document.getElementById('app').innerHTML = ''\n}\n\ndocument.getElementById('__sfc-styles').innerHTML = window.__css__\nconst app = window.__app__ = _createApp(__modules__["${e}"].default)\napp.config.errorHandler = e => console.error(e)\napp.mount('#app')\n`.trim(),g="<template>\n  <h1>{{ msg }}</h1>\n</template>\n\n<script setup>\nconst msg = 'Hello World!'\n<\/script>\n".trim(),v=y(m),w='\n{\n  "imports": {\n  }\n}'.trim();class b{constructor(e,t=""){this.compiled={js:"",css:"",ssr:""},this.filename=e,this.code=t}}let h={};h={[m]:new b(m,g),[_]:new b(_,v)};const $=n.reactive({files:h,activeFilename:m,get activeFile(){return $.files[$.activeFilename]},get importMap(){const e=$.files["import-map.json"];return e&&e.code},errors:[]});n.watchEffect((()=>f($.activeFile)));const S=n.computed((()=>$.activeFilename)),F=n.computed((()=>y($.activeFilename)));for(const e in $.files)e!==m&&f($.files[e]);function x(){const e={};for(const t in $.files)e[t]=$.files[t].code;return e}function E(e,t){$.activeFilename=e,$.activeFile.code=t}async function O(e,n=new Set){if(n.has(e))return[];n.add(e),await f(e);const{js:s,css:o}=e.compiled,i=new t.MagicString(s),a=t.babelParse(s,{sourceFilename:e.filename,sourceType:"module",plugins:[...r.babelParserDefaultPlugins]}).program.body,c=new Map,l=new Set,p=new Set,d=new Map;function u(e,t){const r=t.replace(/^\.\/+/,"");if(!(r in $.files))throw new Error(`File "${r}" does not exist.`);if(p.has(r))return d.get(r);p.add(r);const n=`__import_${p.size}__`;return d.set(r,n),i.appendLeft(e.start,`const ${n} = __modules__[${JSON.stringify(r)}]\n`),n}function m(e,t=e){i.append(`\n__export__(__module__, "${e}", () => ${t})`)}i.prepend(`window.__modules__ = {}\nwindow.__css__ = ''\n\nconst __module__ = __modules__[${JSON.stringify(e.filename)}] = { [Symbol.toStringTag]: "Module" }\n\n`);for(const e of a)if("ImportDeclaration"===e.type){if(e.source.value.startsWith("./")){const t=u(e,e.source.value);for(const r of e.specifiers)"ImportSpecifier"===r.type?c.set(r.local.name,`${t}.${r.imported.name}`):"ImportDefaultSpecifier"===r.type?c.set(r.local.name,`${t}.default`):c.set(r.local.name,t);i.remove(e.start,e.end)}}for(const e of a){if("ExportNamedDeclaration"===e.type)if(e.declaration){if("FunctionDeclaration"===e.declaration.type||"ClassDeclaration"===e.declaration.type)m(e.declaration.id.name);else if("VariableDeclaration"===e.declaration.type)for(const t of e.declaration.declarations){const e=P(t.id).map((e=>e.name));for(const t of e)m(t)}i.remove(e.start,e.declaration.start)}else if(e.source){const t=u(e,e.source.value);for(const r of e.specifiers)m(r.exported.name,`${t}.${r.local.name}`);i.remove(e.start,e.end)}else{for(const t of e.specifiers){const e=t.local.name,r=c.get(e);m(t.exported.name,r||e)}i.remove(e.start,e.end)}if("ExportDefaultDeclaration"===e.type&&i.overwrite(e.start,e.start+14,"__module__.default ="),"ExportAllDeclaration"===e.type){const t=u(e,e.source.value);i.remove(e.start,e.end),i.append(`\nfor (const key in ${t}) {\n        if (key !== 'default') {\n          __export__(__module__, key, () => ${t}[key])\n        }\n      }`)}}for(const e of a)"ImportDeclaration"!==e.type&&t.walkIdentifiers(e,((e,t,r)=>{const n=c.get(e.name);if(n)if(j(t)&&t.shorthand)t.inPattern&&!M(t,r)||i.appendLeft(e.end,`: ${n}`);else if("ClassDeclaration"===t.type&&e===t.superClass){if(!l.has(e.name)){l.add(e.name);const t=r[1];i.prependRight(t.start,`const ${e.name} = ${n};\n`)}}else i.overwrite(e.start,e.end,n)}));t.walk(a,{enter(e,t){if("Import"===e.type&&"CallExpression"===t.type){const r=t.arguments[0];"StringLiteral"===r.type&&r.value.startsWith("./")&&(i.overwrite(e.start,e.start+6,"__dynamic_import__"),i.overwrite(r.start,r.end,JSON.stringify(r.value.replace(/^\.\/+/,""))))}}}),o&&i.append(`\nwindow.__css__ += ${JSON.stringify(o)}`);const _=[F.value,i.toString()];if(p.size)for(const e of p){const t=await O($.files[e],n);_.push(...t)}return _}const j=e=>"ObjectProperty"===e.type&&!e.computed;function P(e,t=[]){switch(e.type){case"Identifier":t.push(e);break;case"MemberExpression":let r=e;for(;"MemberExpression"===r.type;)r=r.object;t.push(r);break;case"ObjectPattern":e.properties.forEach((e=>{"RestElement"===e.type?P(e.argument,t):P(e.value,t)}));break;case"ArrayPattern":e.elements.forEach((e=>{e&&P(e,t)}));break;case"RestElement":P(e.argument,t);break;case"AssignmentPattern":P(e.left,t)}return t}function M(e,t){if(e&&("ObjectProperty"===e.type||"ArrayPattern"===e.type)){let e=t.length;for(;e--;){const r=t[e];if("AssignmentExpression"===r.type)return!0;if("ObjectProperty"!==r.type&&!r.type.endsWith("Pattern"))break}}return!1}e.APP_FILE=m,e.COMP_IDENTIFIER=l,e.File=b,e.MAIN_CODE=v,e.MAIN_FILE=_,e.WELCOME_CODE=g,e.activeFilename=S,e.addFile=function(e,t){if(!e.endsWith(".vue")&&!e.endsWith(".js")&&"import-map.json"!==e)return void($.errors=["Sandbox only supports *.vue, *.js files or import-map.json."]);if(e in $.files)return void($.errors=[`File "${e}" already exists.`]);const r=$.files[e]=new b(e);r.code="import-map.json"===e?w:t,E(e,r.code)},e.changeFile=function(e,t){if(!(e in $.files))return void($.errors=[`File "${e}" is not exists.`]);E($.files[e].filename,t)},e.compileFile=f,e.compileModules=async function(e){if(e!==S.value)return[];const t=await O($.files[e]);return["color: white","background: #42b983","margin-left: 4px","padding: 2px 4px","border-radius: 2px"].join(";"),t.reverse()},e.deleteFile=function(e){confirm(`Are you sure you want to delete ${e}?`)&&($.activeFilename===e&&($.activeFilename=m),delete $.files[e])},e.encodeFiles=()=>btoa(JSON.stringify(x())),e.exportFiles=x,e.mainCode=F,e.setActive=E,e.store=$,Object.defineProperty(e,"__esModule",{value:!0})}));
