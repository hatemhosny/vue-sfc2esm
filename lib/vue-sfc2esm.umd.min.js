!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@vue/compiler-sfc"),require("@vue/shared"),require("vue"),require("@vue/compiler-sfc/dist/compiler-sfc.esm-browser")):"function"==typeof define&&define.amd?define(["exports","@vue/compiler-sfc","@vue/shared","vue","@vue/compiler-sfc/dist/compiler-sfc.esm-browser"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["vue-sfc2esm"]={},e.sfcCompiler,e.shared,e.Vue,e.sfcCompilerEsm)}(this,(function(e,t,r,n,s){"use strict";function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}const i="__sfc__";let a=o(s);async function c({filename:e,code:t,compiled:r}){if(!t.trim())return void(r.errors=[]);if(!e.endsWith(".vue"))return r.js=r.ssr=t,void(r.errors=[]);const n=Buffer.from(e).toString("base64"),{errors:s,descriptor:o}=a.parse(t,{filename:e,sourceMap:!0});if(s.length)return void(r.errors=s);if(o.script&&o.script.lang||o.scriptSetup&&o.scriptSetup.lang||o.styles.some((e=>e.lang))||o.template&&o.template.lang)return void(r.errors=['lang="x" pre-processors are not supported in the in-browser playground.']);const i=o.styles.some((e=>e.scoped));let c="",f="";const d=e=>{c+=e,f+=e},u=l(o,n,!1);if(!u)return;const[m,_]=u;if(c+=m,o.scriptSetup){const e=l(o,n,!0);if(!e)return;f+=e[0]}else f+=m;if(o.template&&!o.scriptSetup){const e=p(o,n,_,!1);if(!e)return;c+=e;const t=p(o,n,_,!0);if(!t)return;f+=t}i&&d(`\n__sfc__.__scopeId = ${JSON.stringify(`data-v-${n}`)}`),(c||f)&&(d(`\n__sfc__.__file = ${JSON.stringify(e)}\nexport default __sfc__`),r.js=c.trimStart(),r.ssr=f.trimStart());let y="";for(const t of o.styles){if(t.module)return void(r.errors=["<style module> is not supported in the playground."]);const s=await a.compileStyleAsync({source:t.content,filename:e,id:n,scoped:t.scoped,modules:!!t.module});s.errors.length?s.errors[0].message.includes("pathToFileURL")||(r.errors=s.errors):y+=s.code+"\n"}r.css=y?y.trim():"/* No <style> tags present */",r.errors=[]}function l(e,t,r){if(!e.script&&!e.scriptSetup)return["\nconst __sfc__ = {}",void 0];try{const n=a.compileScript(e,{id:t,refSugar:!0,inlineTemplate:!0,templateOptions:{ssr:r,ssrCssVars:e.cssVars}});let s="";return n.bindings&&(s+=`\n/* Analyzed bindings: ${JSON.stringify(n.bindings,null,2)} */`),s+="\n"+a.rewriteDefault(n.content,i),[s,n.bindings]}catch(e){return void S([e])}}function p(e,t,r,n){const s=a.compileTemplate({source:e.template.content,filename:e.filename,id:t,scoped:e.styles.some((e=>e.scoped)),slotted:e.slotted,ssr:n,ssrCssVars:e.cssVars,isProd:!1,compilerOptions:{bindingMetadata:r}});if(s.errors.length)return void S(s.errors);const o=n?"ssrRender":"render";return`\n${s.code.replace(/\nexport (function|const) (render|ssrRender)/,`$1 ${o}`)}\n__sfc__.${o} = ${o}`}const f="App.vue",d="main.js",u=e=>`import { createApp as _createApp } from "vue"\n\nif (window.__app__) {\n  window.__app__.unmount()\n  document.getElementById('app').innerHTML = ''\n}\n\ndocument.getElementById('__sfc-styles').innerHTML = window.__css__\nconst app = window.__app__ = _createApp(__modules__["${e}"].default)\napp.config.errorHandler = e => console.error(e)\napp.mount('#app')\n`.trim(),m="<template>\n  <h1>{{ msg }}</h1>\n</template>\n\n<script setup>\nconst msg = 'Hello World!'\n<\/script>\n".trim(),_=u(f),y='\n{\n  "imports": {\n  }\n}'.trim();class g{constructor(e,t=""){this.compiled={js:"",css:"",ssr:"",errors:[""]},this.filename=e,this.code=t}}let v={};v={[f]:new g(f,m),[d]:new g(d,_)};const w=n.reactive({files:v,activeFilename:f,get activeFile(){return w.files[w.activeFilename]},get importMap(){const e=w.files["import-map.json"];return e&&e.code},errors:[]});n.watchEffect((()=>c(w.activeFile)));const b=n.computed((()=>w.activeFilename)),h=n.computed((()=>u(w.activeFilename)));for(const e in w.files)e!==f&&c(w.files[e]);function $(e,t){w.activeFilename=e,w.activeFile.code=t}function S(e){w.activeFile.compiled.errors=e}async function x(e,n=new Set){if(n.has(e))return[];n.add(e),await c(e);const{js:s,css:o}=e.compiled,i=new t.MagicString(s),a=t.babelParse(s,{sourceFilename:e.filename,sourceType:"module",plugins:[...r.babelParserDefaultPlugins]}).program.body,l=new Map,p=new Set,f=new Set,d=new Map;function u(e,t){const r=t.replace(/^\.\/+/,"");if(!(r in w.files))throw new Error(`File "${r}" does not exist.`);if(f.has(r))return d.get(r);f.add(r);const n=`__import_${f.size}__`;return d.set(r,n),i.appendLeft(e.start,`const ${n} = __modules__[${JSON.stringify(r)}]\n`),n}function m(e,t=e){i.append(`\n__export__(__module__, "${e}", () => ${t})`)}i.prepend(`window.__modules__ = {}\nwindow.__css__ = ''\n\nconst __module__ = __modules__[${JSON.stringify(e.filename)}] = { [Symbol.toStringTag]: "Module" }\n\n`);for(const e of a)if("ImportDeclaration"===e.type){if(e.source.value.startsWith("./")){const t=u(e,e.source.value);for(const r of e.specifiers)"ImportSpecifier"===r.type?l.set(r.local.name,`${t}.${r.imported.name}`):"ImportDefaultSpecifier"===r.type?l.set(r.local.name,`${t}.default`):l.set(r.local.name,t);i.remove(e.start,e.end)}}for(const e of a){if("ExportNamedDeclaration"===e.type)if(e.declaration){if("FunctionDeclaration"===e.declaration.type||"ClassDeclaration"===e.declaration.type)m(e.declaration.id.name);else if("VariableDeclaration"===e.declaration.type)for(const t of e.declaration.declarations){const e=F(t.id).map((e=>e.name));for(const t of e)m(t)}i.remove(e.start,e.declaration.start)}else if(e.source){const t=u(e,e.source.value);for(const r of e.specifiers)m(r.exported.name,`${t}.${r.local.name}`);i.remove(e.start,e.end)}else{for(const t of e.specifiers){const e=t.local.name,r=l.get(e);m(t.exported.name,r||e)}i.remove(e.start,e.end)}if("ExportDefaultDeclaration"===e.type&&i.overwrite(e.start,e.start+14,"__module__.default ="),"ExportAllDeclaration"===e.type){const t=u(e,e.source.value);i.remove(e.start,e.end),i.append(`\nfor (const key in ${t}) {\n        if (key !== 'default') {\n          __export__(__module__, key, () => ${t}[key])\n        }\n      }`)}}for(const e of a)"ImportDeclaration"!==e.type&&t.walkIdentifiers(e,((e,t,r)=>{const n=l.get(e.name);if(n)if(j(t)&&t.shorthand)t.inPattern&&!O(t,r)||i.appendLeft(e.end,`: ${n}`);else if("ClassDeclaration"===t.type&&e===t.superClass){if(!p.has(e.name)){p.add(e.name);const t=r[1];i.prependRight(t.start,`const ${e.name} = ${n};\n`)}}else i.overwrite(e.start,e.end,n)}));t.walk(a,{enter(e,t){if("Import"===e.type&&"CallExpression"===t.type){const r=t.arguments[0];"StringLiteral"===r.type&&r.value.startsWith("./")&&(i.overwrite(e.start,e.start+6,"__dynamic_import__"),i.overwrite(r.start,r.end,JSON.stringify(r.value.replace(/^\.\/+/,""))))}}}),o&&i.append(`\nwindow.__css__ += ${JSON.stringify(o)}`);const _=[h.value,i.toString()];if(f.size)for(const e of f){const t=await x(w.files[e],n);_.push(...t)}return _}const j=e=>"ObjectProperty"===e.type&&!e.computed;function F(e,t=[]){switch(e.type){case"Identifier":t.push(e);break;case"MemberExpression":let r=e;for(;"MemberExpression"===r.type;)r=r.object;t.push(r);break;case"ObjectPattern":e.properties.forEach((e=>{"RestElement"===e.type?F(e.argument,t):F(e.value,t)}));break;case"ArrayPattern":e.elements.forEach((e=>{e&&F(e,t)}));break;case"RestElement":F(e.argument,t);break;case"AssignmentPattern":F(e.left,t)}return t}function O(e,t){if(e&&("ObjectProperty"===e.type||"ArrayPattern"===e.type)){let e=t.length;for(;e--;){const r=t[e];if("AssignmentExpression"===r.type)return!0;if("ObjectProperty"!==r.type&&!r.type.endsWith("Pattern"))break}}return!1}e.addFile=function(e,t){if(!e.endsWith(".vue")&&!e.endsWith(".js")&&"import-map.json"!==e)return void S(["Sandbox only supports *.vue, *.js files or import-map.json."]);if(e in w.files)return void S([`File "${e}" already exists.`]);const r=w.files[e]=new g(e);r.code="import-map.json"===e?y:t,$(e,r.code)},e.changeFile=function(e,t){if(!(e in w.files))return void S([`File "${e}" is not exists.`]);$(w.files[e].filename,t)},e.compileFile=c,e.compileModules=async function(e){if(e!==b.value)return[];const t=await x(w.files[e]);return["color: white","background: #42b983","margin-left: 4px","padding: 2px 4px","border-radius: 2px"].join(";"),t.reverse()},e.deleteFile=function(e){confirm(`Are you sure you want to delete ${e}?`)&&(w.activeFilename===e&&(w.activeFilename=f),delete w.files[e])},e.exportFiles=function(){const e={};for(const t in w.files)e[t]=w.files[t].code;return e},e.recordFileErrors=S,e.store=w,Object.defineProperty(e,"__esModule",{value:!0})}));
