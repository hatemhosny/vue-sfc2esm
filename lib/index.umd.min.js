!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@vue/compiler-sfc/dist/compiler-sfc.esm-browser"),require("@vue/shared"),require("vue"),require("crypto")):"function"==typeof define&&define.amd?define(["exports","@vue/compiler-sfc/dist/compiler-sfc.esm-browser","@vue/shared","vue","crypto"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sfc2esm={},e.sfcCompilerEsm,e.shared,e.Vue,e.Crypto)}(this,(function(e,t,r,n,s){"use strict";function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var i=o(t),a=o(s);const c="App.vue",l="__sfc__";let p=i;async function f({filename:e,code:t,compiled:r}){if(!t.trim())return void(g.errors=[]);if(!e.endsWith(".vue"))return r.js=r.ssr=t,void(g.errors=[]);const n=await async function(e){return a.createHash("sha256").update(e).digest("base64").slice(0,16)}(e),{errors:s,descriptor:o}=p.parse(t,{filename:e,sourceMap:!0});if(s.length)return void(g.errors=s);if(o.script&&o.script.lang||o.scriptSetup&&o.scriptSetup.lang||o.styles.some((e=>e.lang))||o.template&&o.template.lang)return void(g.errors=['lang="x" pre-processors are not supported in the in-browser playground.']);const i=o.styles.some((e=>e.scoped));let c="",l="";const f=e=>{c+=e,l+=e},m=d(o,n,!1);if(!m)return;const[_,y]=m;if(c+=_,o.scriptSetup){const e=d(o,n,!0);if(!e)return;l+=e[0]}else l+=_;if(o.template&&!o.scriptSetup){const e=u(o,n,y,!1);if(!e)return;c+=e;const t=u(o,n,y,!0);if(!t)return;l+=t}i&&f(`\n__sfc__.__scopeId = ${JSON.stringify(`data-v-${n}`)}`),(c||l)&&(f(`\n__sfc__.__file = ${JSON.stringify(e)}\nexport default __sfc__`),r.js=c.trimStart(),r.ssr=l.trimStart());let v="";for(const t of o.styles){if(t.module)return void(g.errors=["<style module> is not supported in the playground."]);const r=await p.compileStyleAsync({source:t.content,filename:e,id:n,scoped:t.scoped,modules:!!t.module});r.errors.length?r.errors[0].message.includes("pathToFileURL")||(g.errors=r.errors):v+=r.code+"\n"}r.css=v?v.trim():"/* No <style> tags present */",g.errors=[]}function d(e,t,r){if(!e.script&&!e.scriptSetup)return["\nconst __sfc__ = {}",void 0];try{const n=p.compileScript(e,{id:t,refSugar:!0,inlineTemplate:!0,templateOptions:{ssr:r,ssrCssVars:e.cssVars}});let s="";return n.bindings&&(s+=`\n/* Analyzed bindings: ${JSON.stringify(n.bindings,null,2)} */`),s+="\n"+p.rewriteDefault(n.content,l),[s,n.bindings]}catch(e){return void(g.errors=[e])}}function u(e,t,r,n){const s=p.compileTemplate({source:e.template.content,filename:e.filename,id:t,scoped:e.styles.some((e=>e.scoped)),slotted:e.slotted,ssr:n,ssrCssVars:e.cssVars,isProd:!1,compilerOptions:{bindingMetadata:r}});if(s.errors.length)return void(g.errors=s.errors);const o=n?"ssrRender":"render";return`\n${s.code.replace(/\nexport (function|const) (render|ssrRender)/,`$1 ${o}`)}\n__sfc__.${o} = ${o}`}const m="\n<template>\n  <h1>{{ msg }}</h1>\n</template>\n\n<script setup>\nconst msg = 'Hello World!'\n<\/script>\n".trim();class _{constructor(e,t=""){this.compiled={js:"",css:"",ssr:""},this.filename=e,this.code=t}}let y={};y={"App.vue":new _(c,m)};const g=n.reactive({files:y,activeFilename:c,get activeFile(){return g.files[g.activeFilename]},get importMap(){const e=g.files["import-map.json"];return e&&e.code},errors:[]});n.watchEffect((()=>f(g.activeFile)));for(const e in g.files)e!==c&&f(g.files[e]);function v(e){g.activeFilename=e}async function w(e,n=new Set){if(n.has(e))return[];n.add(e),await f(e);const{js:s,css:o}=e.compiled,i=new t.MagicString(s),a=t.babelParse(s,{sourceFilename:e.filename,sourceType:"module",plugins:[...r.babelParserDefaultPlugins]}).program.body,c=new Map,l=new Set,p=new Set,d=new Map;function u(e,t){const r=t.replace(/^\.\/+/,"");if(!(r in g.files))throw new Error(`File "${r}" does not exist.`);if(p.has(r))return d.get(r);p.add(r);const n=`__import_${p.size}__`;return d.set(r,n),i.appendLeft(e.start,`const ${n} = __modules__[${JSON.stringify(r)}]\n`),n}function m(e,t=e){i.append(`\n__export__(__module__, "${e}", () => ${t})`)}i.prepend(`window.__modules__ = {};\nwindow.__css__ = ''\n\nconst __module__ = __modules__[${JSON.stringify(e.filename)}] = { [Symbol.toStringTag]: "Module" }\n\n`);for(const e of a)if("ImportDeclaration"===e.type){if(e.source.value.startsWith("./")){const t=u(e,e.source.value);for(const r of e.specifiers)"ImportSpecifier"===r.type?c.set(r.local.name,`${t}.${r.imported.name}`):"ImportDefaultSpecifier"===r.type?c.set(r.local.name,`${t}.default`):c.set(r.local.name,t);i.remove(e.start,e.end)}}for(const e of a){if("ExportNamedDeclaration"===e.type)if(e.declaration){if("FunctionDeclaration"===e.declaration.type||"ClassDeclaration"===e.declaration.type)m(e.declaration.id.name);else if("VariableDeclaration"===e.declaration.type)for(const t of e.declaration.declarations){const e=h(t.id).map((e=>e.name));for(const t of e)m(t)}i.remove(e.start,e.declaration.start)}else if(e.source){const t=u(e,e.source.value);for(const r of e.specifiers)m(r.exported.name,`${t}.${r.local.name}`);i.remove(e.start,e.end)}else{for(const t of e.specifiers){const e=t.local.name,r=c.get(e);m(t.exported.name,r||e)}i.remove(e.start,e.end)}if("ExportDefaultDeclaration"===e.type&&i.overwrite(e.start,e.start+14,"__module__.default ="),"ExportAllDeclaration"===e.type){const t=u(e,e.source.value);i.remove(e.start,e.end),i.append(`\nfor (const key in ${t}) {\n        if (key !== 'default') {\n          __export__(__module__, key, () => ${t}[key])\n        }\n      }`)}}for(const e of a)"ImportDeclaration"!==e.type&&t.walkIdentifiers(e,((e,t,r)=>{const n=c.get(e.name);if(n)if(b(t)&&t.shorthand)t.inPattern&&!$(t,r)||i.appendLeft(e.end,`: ${n}`);else if("ClassDeclaration"===t.type&&e===t.superClass){if(!l.has(e.name)){l.add(e.name);const t=r[1];i.prependRight(t.start,`const ${e.name} = ${n};\n`)}}else i.overwrite(e.start,e.end,n)}));t.walk(a,{enter(e,t){if("Import"===e.type&&"CallExpression"===t.type){const r=t.arguments[0];"StringLiteral"===r.type&&r.value.startsWith("./")&&(i.overwrite(e.start,e.start+6,"__dynamic_import__"),i.overwrite(r.start,r.end,JSON.stringify(r.value.replace(/^\.\/+/,""))))}}}),o&&i.append(`\nwindow.__css__ += ${JSON.stringify(o)}`);const _=["\nimport { createApp as _createApp } from \"vue\"\n\nif (window.__app__) {\n  window.__app__.unmount()\n  document.getElementById('app').innerHTML = ''\n}\n\ndocument.getElementById('__sfc-styles').innerHTML = window.__css__\nconst app = window.__app__ = _createApp(__modules__[\"App.vue\"].default)\napp.config.errorHandler = e => console.error(e)\napp.mount('#app')".trim(),i.toString()];if(p.size)for(const e of p){const t=await w(g.files[e],n);_.push(...t)}return _}const b=e=>"ObjectProperty"===e.type&&!e.computed;function h(e,t=[]){switch(e.type){case"Identifier":t.push(e);break;case"MemberExpression":let r=e;for(;"MemberExpression"===r.type;)r=r.object;t.push(r);break;case"ObjectPattern":e.properties.forEach((e=>{"RestElement"===e.type?h(e.argument,t):h(e.value,t)}));break;case"ArrayPattern":e.elements.forEach((e=>{e&&h(e,t)}));break;case"RestElement":h(e.argument,t);break;case"AssignmentPattern":h(e.left,t)}return t}function $(e,t){if(e&&("ObjectProperty"===e.type||"ArrayPattern"===e.type)){let e=t.length;for(;e--;){const r=t[e];if("AssignmentExpression"===r.type)return!0;if("ObjectProperty"!==r.type&&!r.type.endsWith("Pattern"))break}}return!1}e.COMP_IDENTIFIER=l,e.File=_,e.MAIN_FILE=c,e.addFile=function(e){const t=g.files[e]=new _(e);"import-map.json"===e&&(t.code='\n{\n  "imports": {\n  }\n}'.trim()),v(e)},e.compileFile=f,e.compileModules=async function(){const e=await w(g.files[c]);return["color: white","background: #42b983","margin-left: 4px","padding: 2px 4px","border-radius: 2px"].join(";"),e.reverse()},e.deleteFile=function(e){confirm(`Are you sure you want to delete ${e}?`)&&(g.activeFilename===e&&(g.activeFilename=c),delete g.files[e])},e.exportFiles=function(){const e={};for(const t in g.files)e[t]=g.files[t].code;return e},e.setActive=v,e.store=g,Object.defineProperty(e,"__esModule",{value:!0})}));
